# Project 4: Software Implementation and Optimization of SM3

> **目标**：基于国密哈希算法 SM3 的软件实现，进行高效优化，并实现相关安全验证与应用（长度扩展攻击 & Merkle 树构建）。

---

## 目录

- [1. 项目概览](#1-项目概览)
- [2. SM3 简介](#2-sm3-简介)
  - [2.1 算法特点](#21-算法特点)
  - [2.2 SM3 与 SHA-256 对比](#22-sm3-与-sha-256-对比)
- [3. 项目要求](#3-项目要求)
  - [3.1 基础实现](#31-基础实现)
  - [3.2 软件优化](#32-软件优化)
  - [3.3 长度扩展攻击](#33-长度扩展攻击)
  - [3.4 Merkle 树构建](#34-merkle-树构建)
- [4. 数学模型与算法](#4-数学模型与算法)
  - [4.1 SM3 消息填充与分组](#41-sm3-消息填充与分组)
  - [4.2 压缩函数](#42-压缩函数)
  - [4.3 优化思路](#43-优化思路)
- [5. 项目结构](#5-项目结构)
- [6. 接口说明](#6-接口说明)
- [7. 使用说明](#7-使用说明)
- [8. 性能测试](#8-性能测试)
- [9. 实验示例](#9-实验示例)
- [10. 参考文献](#10-参考文献)

---

## 1. 项目概览

本项目围绕 **SM3 哈希算法**的软件实现与应用展开，包括：

- **从零实现 SM3**（基础实现）。
- **逐步优化执行效率**（算法级优化、SIMD 优化、查表法等）。
- **基于 SM3 验证长度扩展攻击**。
- **实现 Merkle 树**（支持 10 万叶子节点）及 **存在性/不存在性证明**。

---

## 2. SM3 简介

### 2.1 算法特点

SM3 是中国商用密码标准哈希函数（GB/T 32905-2016），输出 256 位摘要，主要用于数字签名和消息完整性验证。

其结构与 SHA-256 类似，采用 **Merkle-Damgård** 构造，并有以下特点：

- 压缩函数基于 64 轮迭代。
- 使用布尔函数 \(FF, GG\) 及置换 \(P0, P1\)。
- 扩展消息字 \(W_j, W'_j\)。

### 2.2 SM3 与 SHA-256 对比

| 算法   | 输出长度 | 安全级别   | 性能表现  |
| ---- | ----- | ------ | ----- |
| SHA-256 | 256 bit | 国际标准   | 较快    |
| SM3    | 256 bit | 国密标准   | 略低于 SHA-256 |

---

## 3. 项目要求

### 3.1 基础实现

- 按照 SM3 标准实现 `sm3_hash()` 接口。
- 输入任意长度消息，输出 256 位摘要（hex 字符串）。

### 3.2 软件优化

- **算法优化**：减少不必要的拷贝、优化消息扩展。
- **SIMD/并行化**：使用 `AVX2` 或 `NEON` 指令加速。
- **查表/循环展开**：预计算常量表，展开部分迭代以减少分支。

### 3.3 长度扩展攻击

- 基于已知 SM3 哈希 `H(m)`，构造 `H(m || padding || m2)`，验证能预测后续哈希值。
- 提供 `length_extension_attack.py` 实现。

### 3.4 Merkle 树构建

- 使用 SM3 作为哈希函数，构造 **10 万叶子节点的 Merkle 树**。
- 实现 **存在性证明**（给出某叶子节点的认证路径）。
- 实现 **不存在性证明**（证明节点不在树内）。
- 根据 **RFC 6962**（Certificate Transparency）生成 proof。

---

## 4. 数学模型与算法

### 4.1 SM3 消息填充与分组

对于消息 \(m\)：

1. 附加 `1` bit，再补 `k` 个 `0`，使得长度满足：
   \[
   l + 1 + k \equiv 448 \pmod{512}
   \]
2. 追加原始消息长度（64-bit 表示）。

### 4.2 压缩函数

压缩函数 \(CF(V_i, B_i)\)：

\[
V_{i+1} = CF(V_i, B_i) = V_i \oplus C(V_i, B_i)
\]

其中 `C` 为 64 轮迭代，包含消息扩展和轮函数。

### 4.3 优化思路

- **消息扩展优化**：减少冗余 `P1` 计算。
- **循环展开**：对 64 轮迭代分组处理。
- **SIMD 并行**：同时处理多块消息。

---

## 5. 项目结构



