# Project 6: Google Password Checkup 验证 — Private Intersection Sum with Cardinality 协议实现

---

## 目录

- [项目背景](#项目背景)  
- [项目目标](#项目目标)  
- [协议原理详细介绍](#协议原理详细介绍)  
- [实现思路](#实现思路)  
- [软件结构](#软件结构)  
- [功能模块说明](#功能模块说明)   
- [安全性分析](#安全性分析)  
- [未来扩展方向](#未来扩展方向)  
- [参考文献](#参考文献)  

---

## 项目背景

Google Password Checkup 服务利用 Private Intersection Sum with Cardinality (PIS-C) 协议实现对用户密码泄露风险的隐私保护检测。  
该协议允许两个拥有不同用户数据的参与方在不泄露原始数据的前提下，计算两个用户集合的交集大小及交集中对应值的总和。  
本项目基于论文 [“Two-Sided Malicious Security for Private Intersection-Sum with Cardinality” (eprint.iacr.org/2019/723.pdf)](https://eprint.iacr.org/2019/723.pdf) 中 Section 3.1 的协议，  
对协议进行了详细复现、实现和功能验证。

---

## 项目目标

- 理解并实现 PIS-C 协议的核心算法和交互流程。  
- 保护双方数据隐私，防止集合外元素及其对应值泄露。  
- 保证协议计算正确性，准确得到交集大小及对应值总和。  
- 实现协议的可复用代码结构，方便后续扩展与优化。  
- 通过单元测试与示例验证协议安全性和功能完整性。

---

## 协议原理详细介绍

### 1. 问题定义

- 参与方 P1 持有标识符集合 \( V = \{v_1, v_2, ..., v_{m_1}\} \)。  
- 参与方 P2 持有标识符-值对集合 \( W = \{(w_1, t_1), (w_2, t_2), ..., (w_{m_2}, t_{m_2})\} \)，其中 \(t_j \in \mathbb{Z}^+\)。  
- 目标是计算交集大小 \( |V \cap W| \) 及对应值的总和 \( \sum_{v \in V \cap W} t_v \)，而不泄露非交集元素信息。

### 2. 协议基础

- **哈希映射**：将标识符映射到素数阶群元素，防止明文泄露。  
- **Diffie-Hellman 指数运算**：双方分别使用随机私钥对哈希值进行幂运算，确保隐私。  
- **Paillier 同态加密**：P2 加密对应值，支持密文加法，保护数值隐私。  
- **打乱顺序 (Shuffle)**：隐藏元素对应关系，避免顺序泄露。

### 3. 协议步骤

- P1 对自身标识符进行哈希并指数幂运算后，打乱发送给 P2。  
- P2 对接收的元素再次幂运算，构造交集标签，同时对自身值加密，打乱发送给 P1。  
- P1 对收到数据进行幂运算，匹配交集元素，并利用同态加法合成加密的交集值总和。  
- P1 将加密求和结果发送给 P2，P2 解密得出最终交集求和值。  
- P1 可统计交集大小。

### 4. 安全性

协议基于半诚实模型，保证双方只能获取交集信息，难以推断非交集数据。  
通过 DDH 假设、同态加密安全性及随机打乱实现隐私保护。

---

## 实现思路

- 利用 Python 编写模块化代码，模拟三轮交互过程。  
- 使用 `phe` 库实现 Paillier 同态加密。  
- 使用 Python `hashlib` 进行 SHA-256 哈希映射。  
- 利用随机数生成和列表打乱实现数据混淆。  
- 设计类封装双方逻辑，保持接口清晰。  
- 通过示例数据测试协议正确性和稳定性。

---

## 软件结构

```
project_root/
│
├── ddh_psi_sum.py # 协议主实现及模拟运行
├── party.py # P1 和 P2 参与方类定义
├── utils.py # 工具函数（哈希、打乱等）
├── tests/
│ └── test_ddh_psi.py # 单元测试脚本
├── requirements.txt # 依赖包列表
└── README.md # 本文档

```

## 功能模块说明

- **ddh_psi_sum.py**：模拟协议流程，包含三轮消息交互和结果展示。  
- **party.py**：定义 Party1 和 Party2 类，实现各自协议逻辑。  
- **utils.py**：包含哈希函数、数据打乱与恢复等辅助函数。  
- **tests/**：协议单元测试，验证功能正确性和边界条件。  

---

## 安全性分析

1. 哈希映射及随机指数运算防止原始标识符泄露。

2. __Paillier__ 加密保证数值隐私与计算安全。

3. 打乱顺序避免顺序泄露关联。

4. 协议在半诚实模型下安全，满足 Google Password Checkup 的隐私要求。

## 未来扩展方向

* 增加对恶意参与方的防护机制。

* 支持多方扩展及更复杂的多值隐私计算。

* 结合零知识证明技术增强安全保障。

* 优化性能，适应大规模数据场景。
